function debounce(t,i){let s;return function(...e){if(s){clearTimeout(s)}s=setTimeout(()=>{t.apply(this,e)},i)}}PPVue.component("pp-page-import-tracking",{data(){return{step:0,button1IsDisabled:false,button2IsDisabled:false,isImportModalOpen:false,isShowAdvancedOptions:false,filePath:"",csvDelimiter:"",isMapPreferences:false,fields:{},headers:[],requiredFields:[],mappedItems:[],CSV_IMPORT_ERROR_RETRY_NUM:5,csvImportErrorNum:0,percentage:0,importResult:{},historyRecords:[],isOpenModal:false,recordDetail:{}}},created(){window.addEventListener("beforeunload",e=>{if(this.button2IsDisabled){e.preventDefault();e.returnValue=""}});this.getHistoryUploadRecords()},methods:{handleViewInstructionClick(){this.isImportModalOpen=true},handleContinueClick(){this.uploadFile()},handleFileChange(e){const t=e.target.files[0]?.name;if(t?.length&&!this._checkIsCsv(t)){jQuery.toastr.warning("Sorry, this file type is not permitted!")}},_checkIsCsv(e=""){let t=e.lastIndexOf(".");let i=e.substring(t);return i===".csv"},uploadFile(){const e=this.$refs.fileRef.files[0];if(!this._checkIsCsv(e?.name)){jQuery.toastr.warning("Please choose a CSV file");return}this.button1IsDisabled=true;let t=new FormData;t.append("action","pp_upload_csv");t.append("import",e);t.append("_ajax_nonce",window.pp_param.upload_nonce);jQuery.ajax({type:"POST",url:ajaxurl,data:t,cache:false,processData:false,contentType:false,complete(){},success:e=>{if(false===e.success){this.button1IsDisabled=false;jQuery.toastr.error(e.msg||"Upload failed! Unknown error");return}this.$refs.fileRef.value="";this.filePath=e.data.file;this.getMappingItems()},error(){this.button1IsDisabled=false;jQuery.toastr.error("Server error, please try again or refresh the page")}})},getMappingItems(){const e={action:"pp_mapping_items_csv",_ajax_nonce:window.pp_param.import_nonce,file:this.filePath,delimiter:this.csvDelimiter,map_preferences:this.isMapPreferences};jQuery.ajax({type:"GET",url:ajaxurl,data:e,complete:()=>{this.button1IsDisabled=false},success:e=>{if(false===e.success){jQuery.toastr.error(e.msg||"Upload failed! Unknown error");return}this.fields=e.data.fields;this.headers=e.data.headers.map(e=>({label:e,value:e}));this.headers.unshift({label:"Select a column title",value:""});this.requiredFields=e.data.required_fields;this.mappedItems=e.data.mapped_items;this.step=this.step+1},error(){jQuery.toastr.error("Server error, please try again or refresh the page")}})},getHistoryUploadRecords(){const e={action:"pp_tracking_number_import_record",_ajax_nonce:window.pp_param.get_history_nonce};jQuery.ajax({type:"GET",url:ajaxurl,data:e,success:e=>{this.historyRecords=e.data}})},handleMapSelectChange(e,t){this.mappedItems[t]=e},handleCsvDelimiterChange(e){this.csvDelimiter=e},handleImportClick(){const e=this._checkRequiredFields();if(!e)return false;this.step=this.step+1;this.button2IsDisabled=true;this.csvImportErrorNum=0;this._importFile(this.filePath)},handleViewOrdersButtonClick(){window.location.href=window.pp_param.shipments_page_link},handleUploadAgainButtonClick(){this.step=0},handleBackButtonClick(){window.location.href=window.location.href.replace(/#.*/,"")},handleShowAdvancedOptionsButtonClick(){this.isShowAdvancedOptions=!this.isShowAdvancedOptions},handleImportModalClose(){this.isImportModalOpen=false},_checkRequiredFields(){const t=[];this.requiredFields.forEach(e=>{if(!this.mappedItems[e]){t.push(this.fields[e])}});if(t.length){if(t.length===1){jQuery.toastr.warning(t[0]+" is required to map")}else{jQuery.toastr.warning("These fields are required to map: "+t.join(", "))}return false}return true},_importFile(t,e=0,i=0){const s={file:t,id:e,delimiter:this.csvDelimiter,map_from:this.mappedItems,position:i};jQuery.ajax({type:"POST",url:`${ajaxurl}?action=pp_import_csv&_ajax_nonce=${window.pp_param.import_nonce}`,contentType:"application/json",data:JSON.stringify(s),success:e=>{this.percentage=e.data.percentage;if(e.data.percentage<100){this._importFile(t,e.data.id,e.data.position)}else{this.csvImportErrorNum=0;this.importResult=e.data;this.getHistoryUploadRecords();setTimeout(()=>{this.step=this.step+1;this.button2IsDisabled=false;this.percentage=0},1e3)}},error:()=>{if(this.csvImportErrorNum<this.CSV_IMPORT_ERROR_RETRY_NUM){this.csvImportErrorNum++;setTimeout(()=>this._importFile(t,e,i),2e3)}else{this.button2IsDisabled=false;this.step=this.step-1;jQuery.toastr.error("Server error, please try again or refresh the page")}}})},showRecordDetail(e){this.recordDetail=e;this.isOpenModal=true}},template:`<div id="pp-page-import-tracking" class="pp-wrap">
<div style="margin-top:20px"><a class="pp-btn-back" @click="handleBackButtonClick">back</a></div>
<h2>Import tracking number</h2>
<div class="woocommerce-progress-form-wrapper">
<pp-steps :active="step">
<pp-step title="Upload CSV file"/>
<pp-step title="Column mapping"/>
<pp-step title="Import"/>
<pp-step title="Done!"/>
</pp-steps>

<div v-if="step === 0">
<div class="pp-card" style="margin:0;">
<div class="pp-card-header" style="flex-direction:column;align-items:flex-start;">
<h3>Select CSV file to import</h3>
<p class="pp-m-t-2 pp-m-b-1 pp-text-subdued">Your CSV file should have following columns:</p>
<p class="pp-text-subdued"><b>Required:</b> Order number, Tracking number</p>
<p class="pp-text-subdued"><b>Optional:</b> Courier, SKU, Qty, Date shipped, Mark order as Completed</p>
<div class="pp-m-t-2 pp-text-subdued" style="display:flex">
<p>Note:&nbsp;</p>
<ol style="position:relative;left:16px;margin:0;line-height:20px">
<li style="margin:0">Product sku and quantity are required if you need to ship the items in one order into multiple packages. <a href="https://docs.parcelpanel.com/woocommerce/article/how-to-import-tracking-number-with-a-csv-file/" target="_blank">Learn more</a>.</li>
<li style="margin:0">If the total quantity shipped exceeds the total quantity of items in an order, the system will automatically adjust to the maximum shippable quantity of the items.</li>
</ol>
</div>
</div>
<div class="pp-card-body" style="padding-bottom:0;box-shadow:inset 0 -1px 0 #ddd">
<table class="form-table pp-importer-options">
<tr>
<th class="row">
<span class="pp-label">Choose a local file</span>
</th>
<td>
<input type="file" ref="fileRef" accept=".csv" @change="handleFileChange"/>
</td>
</tr>
<tr>
<th><span class="pp-label">Mapping preferences</span><br></th>
<td>
<checkbox-control v-model="isMapPreferences" label="Enable this feature to save previous column mapping settings automatically"/>
</td>
</tr>
<tr v-show="isShowAdvancedOptions">
<th><span class="pp-label">CSV Delimiter</span><br></th>
<td>
<div style="display:flex">
  <inputtext w="68px" minw="68px" h="32px" pvalue="" :showtext="false" placeholder="," :input-value="csvDelimiter" @change_value="handleCsvDelimiterChange" style="width:auto"/>
  <p style="margin:0 0 0 8px">This sets the separator of your CSV files to separates the data in your file into distinct fields</p>
</div>
</td>
</tr>
</table>
</div>
<div class="pp-card-body">
<pp-stack style="align-items:center;">
<pp-stack-item>
<a @click="handleShowAdvancedOptionsButtonClick">{{ isShowAdvancedOptions ? 'Hide advanced options' : 'Show advanced options' }}</a>
</pp-stack-item>
<pp-stack-item fill/>
<pp-stack-item>
<pp-button variant="primary" :isBusy="button1IsDisabled" :disabled="button1IsDisabled" @click="handleContinueClick">Continue</pp-button>
</pp-stack-item>
</pp-stack>
</div>
</div>
<p style="margin:4px 0 0;font-size:14px">You can also copy or download a sample template to import tracking numbers. <a @click="handleViewInstructionClick">View instruction</a></p>
</div>

<div v-if="step === 1">
<div class="pp-card">
<div class="pp-card-header" style="flex-direction:column;align-items:flex-start;">
<h3>Map CSV fields to orders</h3>
<p class="pp-text-subdued pp-m-t-1">Select fields from your CSV file to map against orders fields.</p>
</div>
<div style="margin:-16px 0 0;">

<table class="pp-importer-mapping-table">
<thead>
<tr>
<th width="50%">Column name</th>
<th>Map to field</th>
</tr>
</thead>

<tbody>
<tr v-for="(val, key) in fields">
<td class="wc-importer-mapping-table-name">
<select-control :def="mappedItems[key] || ''" :list="headers" @change_value="handleMapSelectChange($event, key)"/>
</td>
<td>
{{ val }}
<strong v-if="requiredFields.includes(key)">(*Required)</strong>
<template v-else>(Optional)</template>
</td>
</tr>
</tbody>
</table>

</div>
<div class="pp-card-body" style="border-top:1px solid #ddd;">
<pp-stack>
<pp-stack-item fill/>
<pp-stack-item>
<pp-button variant="primary" :isBusy="button2IsDisabled" :disabled="button2IsDisabled" @click="handleImportClick">Import</pp-button>
</pp-stack-item>
</pp-stack>
</div>
</div>
</div>

<div v-if="step === 2">
<div class="pp-card">
<div class="pp-card-header" style="flex-direction:column;align-items:flex-start;">
<h3>Importing</h3>
<p class="pp-text-subdued pp-m-t-1">Your orders are now being imported…</p>
</div>
<div class="pp-card-body">
  <div class="pp-m-t-4" style="width: 100%">
    <div class="pp-m-b-1" style="display:flex">
      <div><p>Uploading:</p></div>
      <div style="flex: 1;text-align: right;"><p>{{ percentage }}%</p></div>
    </div>
    <pp-progress :w="percentage"></pp-progress>

    <p class="pp-m-t-1"><strong>Please DO NOT close or refresh this page before it was completed.</strong></p>
  </div>
</div>
</div>
</div>

<div v-if="step === 3">
<div class="pp-card">
<div class="pp-card-body" style="box-shadow:rgb(221 221 221) 0 -1px 0 inset">
<div style="text-align:center">
  <span style="display:inline-block;width:72px;vertical-align:top;fill:var(--wp-admin-theme-color);"><svg style="display:block;" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M0 10a10 10 0 1 0 20 0 10 10 0 0 0-20 0zm15.2-1.8a1 1 0 0 0-1.4-1.4l-4.8 4.8-2.3-2.3a1 1 0 0 0-1.4 1.4l3 3c.4.4 1 .4 1.4 0l5.5-5.5z"/></svg></span>
  <p style="margin-top:8px;color:var(--wp-admin-theme-color);font-weight:600;font-size:16px;line-height:24px;">Import Completed</p>
  <div style="display:inline-block;margin-top:20px;text-align:left">
    <p><span style="margin-top:1px;margin-right:4px;display:inline-block;width:16px;fill:#00d2af;vertical-align:top;"><svg style="display:block;" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M0 10a10 10 0 1 0 20 0 10 10 0 0 0-20 0zm15.2-1.8a1 1 0 0 0-1.4-1.4l-4.8 4.8-2.3-2.3a1 1 0 0 0-1.4 1.4l3 3c.4.4 1 .4 1.4 0l5.5-5.5z"/></svg>
</span><span>{{ importResult.succeeded }} tracking numbers imported successfully</span></p>
    <p class="pp-m-t-1"><span style="margin-top:1px;margin-right:4px;display:inline-block;width:16px;fill:#ff4c36;vertical-align:top;"><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M0 10c0-5.514 4.486-10 10-10s10 4.486 10 10-4.486 10-10 10-10-4.486-10-10zm7.707-3.707a1 1 0 0 0-1.414 1.414l2.293 2.293-2.293 2.293a1 1 0 1 0 1.414 1.414l2.293-2.293 2.293 2.293a1 1 0 0 0 1.414-1.414l-2.293-2.293 2.293-2.293a1 1 0 0 0-1.414-1.414l-2.293 2.293-2.293-2.293z"/></svg>
</span><span>{{ importResult.failed }} tracking numbers imported failed, <a @click="showRecordDetail(importResult)">view details</a></span></p>
  </div>
  <div class="pp-m-t-5">
  <pp-stack style="justify-content:center;">
    <pp-stack-item><pp-button variant="primary" @click="handleViewOrdersButtonClick">View shipments</pp-button></pp-stack-item>
    <pp-stack-item><pp-button variant="primary" @click="handleUploadAgainButtonClick">Upload again</pp-button></pp-stack-item>
  </pp-stack>
  </div>
</div>
</div>
<div class="pp-card-body">
<div style="margin-bottom:10px"><h4 style="margin:0">Import records</h4></div>
<p v-for="val in historyRecords" class="pp-m-t-1">{{ val.date }} Uploaded {{ val.filename }}, {{ val.total }} tracking numbers, failed to upload {{ val.failed }}, <a @click="showRecordDetail(val)">view details.</a></p>
</div>
</div>
</div>

</div>

<modal @cancel="isOpenModal=false" :open="isOpenModal" title="View details" cancel="Close">
<div>
  <div class="pp-import-record-detail-row pp-m-t-1">
    <div>Import file name:</div>
    <div>{{ recordDetail.filename }}</div>
  </div>
  <div class="pp-import-record-detail-row pp-m-t-1">
    <div>Total tracking numbers:</div>
    <div>{{ recordDetail.total }}</div>
  </div>
  <div class="pp-import-record-detail-row pp-m-t-1">
    <div>Succeeded:</div>
    <div>{{ recordDetail.succeeded }}</div>
  </div>
  <div class="pp-import-record-detail-row pp-m-t-1">
    <div>Failed:</div>
    <div>{{ recordDetail.failed }}</div>
  </div>
  <div class="pp-import-record-detail-row pp-m-t-1">
    <div>Details:</div>
    <div>
      <p v-for="(val, index) in recordDetail.details" :key="index" class="pp-m-t-1">{{ val }}</p>
    </div>
  </div>
</div>
</modal>
  
<pp-import-tracking-modal :open="isImportModalOpen" @close="handleImportModalClose"/>

<pp-popup-pic></pp-popup-pic>
</div>`});PPVue.component("pp-import-tracking-modal",{props:{open:Boolean},data(){return{CSV_IMPORT_ERROR_RETRY_NUM:5,pageParam:window.pp_param,isOpenModal:false,isExporting:false,percentage:0,fileFlow:[],isShowDetails:false,showProgress:false,Details:{},HistoryRecords:[],isCSVFile:false,isOpened:false}},created(){window.addEventListener("beforeunload",e=>{if(this.showProgress){e.preventDefault();e.returnValue=""}});this.getHistoryUploadRecords()},watch:{open(e){this.isOpenModal=e}},methods:{getFile(e){this.fileFlow=e.target.files;let t=this.fileFlow[0].name;let i=t.lastIndexOf(".");let s=t.substr(i+1);if(s!=="csv"){this.isCSVFile=false;jQuery.toastr.warning("Sorry, this file type is not permitted!")}else{this.isCSVFile=true}},uploadFile(e){if(this.showProgress){jQuery.toastr.warning("Importing");return}if(!this.isCSVFile){jQuery.toastr.error("Please choose a CSV file");return}this.showProgress=true;this.percentage=1;let t=this.fileFlow[0];let i=new FormData;i.append("action","pp_upload_csv");i.append("import",t);i.append("_ajax_nonce",window.pp_param.upload_nonce);jQuery.ajax({type:"POST",url:ajaxurl,data:i,cache:false,processData:false,contentType:false,success:e=>{if(false===e.success){this.showProgress=false;jQuery.toastr.error(e.msg||"Upload failed! Unknown error");return}this.jQueryrefs.iptFile.value="";this.csvImportErrorNum=0;this.importFile(e.data.file)},error(){jQuery.toastr.error("Server error, please try again or refresh the page")}})},importFile(t,e=0,i=0){jQuery.ajax({type:"POST",url:ajaxurl,data:{_ajax_nonce:window.pp_param.import_nonce,action:"pp_import_csv",file:t,id:e,position:i},success:e=>{this.percentage=e.data.percentage;if(e.data.percentage<100){this.importFile(t,e.data.id,e.data.position)}else{this.csvImportErrorNum=0;this.Details=e.data;this.getHistoryUploadRecords();setTimeout(()=>{this.isShowDetails=true;this.percentage=0;this.showProgress=false},1e3)}},error:()=>{if(this.csvImportErrorNum<CSV_IMPORT_ERROR_RETRY_NUM){this.csvImportErrorNum++;setTimeout(()=>this.importFile(t,e,i),2e3)}else{jQuery.toastr.error("Server error, please try again or refresh the page")}}})},getHistoryUploadRecords(){let e={action:"pp_tracking_number_import_record",_ajax_nonce:window.pp_param.get_history_nonce};jQuery.ajax({type:"GET",url:ajaxurl,data:e,success:e=>{this.HistoryRecords=e.data}})},isShowDetailView(e){this.isShowDetails=!this.isShowDetails;if(this.isShowDetails){this.Details=e}},handleModalCancel(){this.$emit("close");this.isOpenModal=false}},template:`<modal @ok="uploadFile" @cancel="handleModalCancel" :open="isOpenModal" title="Import tracking number" cancel="Close" :confirm="isShowDetails ? null : 'Import'">
<div v-show="!isShowDetails">
  <div>
    <p class="pp-m-y-0">Step 1: Copy the <a href="https://docs.google.com/spreadsheets/d/1NEJqC-yS0GoAkFx5jCqyVstP-tDgPvqle_hbksFWZ4g/copy" target="_blank">sample template</a> on Google Sheets(strongly recommend) or download
      <a :href="pageParam.import_template_file_link" target="_blank">this CSV file</a>.</p>
    <p class="pp-m-t-4">Step 2: Fill in the data following the <a href="https://docs.parcelpanel.com/woocommerce/article/57" target="_blank">Import Template Instructions</a>. Tracking number that do not comply with the instructions will not be imported.</p>
    <p class="pp-m-t-4">Step 3: Download the file in a CSV format and upload it.</p>
  </div>

  <div v-show="!showProgress" class="pp-m-t-4"><input type="file" ref="iptFile" @change="getFile" accept=".csv" style="padding:0;height:36px;line-height:36px"></div>
  <div v-show="showProgress" class="pp-m-t-4" style="width: 100%">
    <div class="pp-m-b-1" style="display:flex">
      <div><p>Uploading:</p></div>
      <div style="flex: 1;text-align: right;"><p>{{percentage}}%</p></div>
    </div>
    <pp-progress :w="percentage"></pp-progress>

    <p class="pp-m-t-1"><strong>Please DO NOT close or refresh this page before it was completed.</strong></p>
  </div>

  <div class="pp-m-t-5" style="margin-bottom: 10px"><h4 style="margin: 0">Import records</h4></div>
  <p v-for="val in HistoryRecords" class="pp-m-t-1">{{ val.date }} Uploaded {{ val.filename }}, {{ val.total }} tracking numbers, failed to upload {{ val.failed }}, <a @click="isShowDetailView(val)">view details.</a></p>
</div>
<div v-show="isShowDetails">
  <div class="pp-m-b-3">
    <a @click="isShowDetailView" class="pp-btn-back">back</a>
  </div>
  <div class="pp-import-record-detail-row pp-m-t-1">
    <div>Import file name:</div>
    <div>{{Details.filename}}</div>
  </div>
  <div class="pp-import-record-detail-row pp-m-t-1">
    <div>Total tracking numbers:</div>
    <div>{{Details.total}}</div>
  </div>
  <div class="pp-import-record-detail-row pp-m-t-1">
    <div>Succeeded:</div>
    <div>{{Details.succeeded}}</div>
  </div>
  <div class="pp-import-record-detail-row pp-m-t-1">
    <div>Failed:</div>
    <div>{{Details.failed}}</div>
  </div>
  <div class="pp-import-record-detail-row pp-m-t-1">
    <div>Details:</div>
    <div>
      <p v-for="(val, index) in Details.details" :key="index" class="pp-m-t-1">{{val}}</p>
    </div>
  </div>
</div>
</modal>`});PPVue.component("pp-stack",{template:`<div class="pp-stack"><slot/></div>`});PPVue.component("pp-stack-item",{props:{fill:Boolean},template:`<div class="pp-stack__item" :class="{ 'pp-stack__item--fill': fill }"><slot/></div>`});PPVue.component("pp-steps",{props:{active:Number,finishStatus:{type:String,default:"done"},processStatus:{type:String,default:"active"}},data(){return{steps:[]}},watch:{steps(e){e.forEach((e,t)=>{e.index=t})}},template:`<ol class="pp-progress-steps"><slot/></ol>`});PPVue.component("pp-step",{props:{title:String},data(){return{index:-1,lineStyle:{},internalStatus:""}},beforeCreate(){this.$parent.steps.push(this)},beforeDestroy(){const e=this.$parent.steps;const t=e.indexOf(this);if(t>=0){e.splice(t,1)}},mounted(){const t=this.$watch("index",e=>{this.$watch("$parent.active",this.updateStatus,{immediate:true});t()})},methods:{updateStatus(e){if(e>this.index){this.internalStatus=this.$parent.finishStatus}else if(e===this.index){this.internalStatus=this.$parent.processStatus}else{this.internalStatus="wait"}}},template:'<li :class="`is-${internalStatus}`">{{ title }}</li>'});PPVue.component("toggle-control",{model:{event:"change"},props:{value:{type:Boolean,default:false},disabled:{type:Boolean,default:false}},template:`<div>
<span class="components-form-toggle" :class="{'is-checked': value, 'is-disabled': disabled}">
  <input @change="$emit('change', $event.target.checked)" v-model="value" :disabled="disabled" class="components-form-toggle__input" type="checkbox">
  <span class="components-form-toggle__track"></span>
  <span class="components-form-toggle__thumb"></span>
</span>
</div>`});PPVue.component("checkbox-control",{model:{prop:"checked",event:"change"},props:{label:String,checked:Boolean,id:{type:Number,default:0}},methods:{handleChange(e){this.$emit("change",e.target.checked,this.id);this.$emit("get_id",this.id,e.target.checked)}},template:`<label class="PP-Choice components-checkbox-control__label"><span class="components-checkbox-control__input-container">
<input v-model="checked" @change="handleChange" type="checkbox" class="components-checkbox-control__input"/>
<!--复选框需要有这个才会显示图标，具体我也不知道为啥-->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" role="img" class="components-checkbox-control__checked" aria-hidden="true" focusable="false"><path d="M18.3 5.6L9.9 16.9l-4.6-3.4-.9 1.2 5.8 4.3 9.3-12.6z"></path></svg>
</span><span class="PP-Choice__Label">{{label}}</span></label>`});PPVue.component("panel-toggle",{data:()=>{return{open:false}},props:{isOpen:{type:Boolean,default:false},title:{type:String,default:"默认标题"}},mounted(){if(this.isOpen!==this.open){this.open=this.isOpen}},template:`<div class="components-panel__body" :class="{'is-opened': open}">
  <div class="components-panel__body-title" @click="open = !open">
    <slot name="title" v-if="$slots.title"></slot><span v-else>{{title}}</span>
    <svg v-if="open" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="components-panel__arrow" role="img" aria-hidden="true" focusable="false"><path d="M6.5 12.4L12 8l5.5 4.4-.9 1.2L12 10l-4.5 3.6-1-1.2z"></path></svg>
    <svg v-else width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="components-panel__arrow" role="img" aria-hidden="true" focusable="false"><path d="M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"></path></svg>
  </div>
  <!-- 显示的内容 -->
  <div v-if="open">
    <slot></slot>
  </div>
</div>`});PPVue.component("select-control",{props:{label:{type:String},helpText:{type:String},list:{type:Array,default(){return[{label:"第1个选项",value:"1",disabled:true},{label:"第2个选项",value:"2",disabled:false}]}},def:{type:String,default:"1"}},methods:{change(e){let t=e.target.value;this.$emit("change_value",t,this.pvalue)}},template:`<div  class="components-base-control">
<div class="components-base-control__field">
  <div data-wp-component="Flex"
       class="components-flex components-select-control">
    <div v-if="label" data-wp-component="FlexItem"
         class="components-flex-item">
      <label data-wp-component="Text"
        class="components-truncate components-text components-input-control__label"
        >{{label}}</label>
    </div>

    <div class="components-input-control__container">
      <select 
        v-model="def"
        class="components-select-control__input" 
        style="height:36px "
        @input="change($event)"
      >
        <option 
          v-for="(item, index) in list" 
          :key="index" 
          :disabled="item.disabled" 
          :value="item.value"
        >
          {{item.label}}
        </option>
      </select>
      <div aria-hidden="true" class="components-input-control__backdrop"></div>
    </div>
  </div>
</div>

<p v-if="helpText" class="components-base-control__help">{{helpText}}</p>
</div>`});PPVue.component("modal",{data(){return{isOpen:false}},props:{title:{type:String,default:"Title"},open:Boolean,cancel:{type:String,default:"Cancel"},confirm:String,okType:String},mounted(){if(this.isOpen!==this.open){this.isOpen=this.open}},watch:{open(e){this.isOpen=e}},methods:{onCancel(){this.isOpen=false;this.$emit("cancel")},onConfirm(){this.$emit("ok")}},template:`<div v-if="isOpen" class="components-modal__screen-overlay pp-modal">
    <div class="components-modal__frame" role="dialog" tabindex="-1">
      <div class="components-modal__content" style="display:flex;flex-direction:column;" role="document">
        <div class="components-modal__header">
          <!--标题-->
          <div class="components-modal__header-heading-container">
            <h1 class="components-modal__header-heading">{{title}}</h1>
          </div>

          <!--关闭按钮-->
          <button @click="onCancel" type="button" class="components-button has-icon" style="position: unset;margin-right:-8px;" aria-label="Close dialog">
            <svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.414 10l6.293-6.293a1 1 0 10-1.414-1.414L10 8.586 3.707 2.293a1 1 0 00-1.414 1.414L8.586 10l-6.293 6.293a1 1 0 101.414 1.414L10 11.414l6.293 6.293A.998.998 0 0018 17a.999.999 0 00-.293-.707L11.414 10z" fill="#5C5F62"/></svg>
          </button>
        </div>

        <div class="pp-modal-body">
          <slot></slot>
        </div>
      </div>
      <div class="components-modal__footer">
        <slot name="footer"></slot>
        <pp-button v-show="cancel" variant="secondary" @click="onCancel">{{cancel}}</pp-button>
        <pp-button v-show="confirm" variant="primary" :is-destructive="'destructive' === okType" @click="onConfirm">{{confirm}}</pp-button>
      </div>
    </div>
  </div>`});PPVue.component("pp-button",{props:{loading:Boolean,isBusy:Boolean,isLink:Boolean,disabled:Boolean,isDestructive:Boolean,variant:String},methods:{submit(e){if(this.loading||this.disabled||this.isBusy){e.preventDefault();return}this.$emit("click")}},computed:{className:{get(){const e="pp-button";return{"components-button":true,[`${e}`]:true,[`is-${this.variant}`]:this.variant,"is-destructive":this.isDestructive,"is-busy":this.isBusy,"is-link":this.isLink,[`${e}-loading`]:this.loading,"has-icon":!!this.$slots.icon}}}},template:`
<button
  type="button"
  :class="className"
  :disabled="disabled"
  @click="submit"
>
  <span v-if="loading" role="img" aria-label="loading" class="icon icon-loading"><svg focusable="false" class="icon-spin" data-icon="loading" width="1em" height="1em" fill="currentColor" aria-hidden="true" viewBox="0 0 1024 1024"><path d="M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"></path></svg></span>
  <slot name="icon"></slot>
  <span><slot></slot></span>
</button>`});PPVue.component("pp-icon-button",{data(){return{buttonClassList:["is-primary","is-secondary","is-destructive","is-primary is-destructive"]}},props:{id:{type:String,default:"0"}},methods:{submit(){this.$emit("click")}},template:`
<button 
  type="button" 
  class="components-button pp-button"
  :class="buttonClassList[id]"
  @click="submit"
>
  <slot></slot>
</button>`});PPVue.component("inputtext",{data(){return{}},props:{showtext:{type:Boolean,default:true},pvalue:{type:String,default:"text"},minw:{type:String,default:"200px"},h:{type:String,default:"36px"},maxw:{type:String,default:"100%"},w:{type:String,default:"36px"},placeholder:String,inputValue:String,disabled:Boolean},methods:{change(e){let t=e.target.value;this.$emit("change_value",t,this.pvalue)}},template:`
<div style="height: 100%; width: 100%">
  <p v-show="showtext" class="pp-m-b-1">{{pvalue}}</p>
  <input
    id="theme-container-width"
    class="components-placeholder__input"
    :style="{height: h, width: w, maxWidth: maxw, minWidth: minw}"
    style="border-radius: 2px; margin: 0;"
    type="text" 
    :placeholder="placeholder" 
    :value="inputValue"
    :disabled="disabled"
    @input="$emit('change_value', $event.target.value)"
  />
</div>
`});PPVue.component("text-area-control",{data(){return{}},props:{labeltext:{type:String,default:"text"},message:{type:String,default:"init Text"},placeholder:String},methods:{change(e){let t=e.target.value;this.$emit("change_value",t)}},template:`<div class="components-base-control__field">
<label class="components-base-control__label">{{labeltext}}</label>
<textarea 
  class="components-textarea-control__input" 
  rows="4" 
  aria-describedby="inspector-textarea-control-5__help"
  style="width:100%;height:100px;border-radius:2px"
  v-model="message"
  @input="change($event)"
  :placeholder="placeholder"
></textarea></div>`});PPVue.component("select-tab",{props:{bool:{type:Boolean,default:true},tab1Text:String,tab2Text:String},data(){return{bool:this.$props.bool}},methods:{toggleTabs:function(e){this.bool=e;this.$emit("enabled",e)}},template:`
<div class="my-tab-panel">
  <ul class="components-tab-panel__tabs pp-m-t-0 pp-m-b-0" style="border-bottom: 1px solid #F0F0F0;">
    <li class="components-button components-tab-panel__tabs-item tab-one" :class="{'is-active':!bool}" @click="toggleTabs(false)">{{tab1Text}}</li>
    <li class="components-button components-tab-panel__tabs-item tab-one" :class="{'is-active':bool}" @click="toggleTabs(true)">{{tab2Text}}</li>
  </ul>
</div>`});PPVue.component("pp-progress",{data(){return{}},props:{w:{type:Number,default:20}},methods:{},template:`
<div style="width: 100%;height: 20px;border-radius: 3px;overflow: hidden;background-color: #e0e1e3;">
  <div style="height: 100%; background-color: rgb(1, 103, 162); transition: all .3s;" :style="{width: w+'%'}"></div>
</div>
`});PPVue.component("pp-search",{data(){return{}},props:{value:{type:String,default:""}},methods:{},template:`
  <div>
    <div class="components-base-control components-search-control">
      <div class="components-base-control__field">
        <div class="components-search-control__input-wrapper">
          <input class="components-search-control__input" id="components-search-control-0" type="search" placeholder="Search" autocomplete="off" value="">
            <div class="components-search-control__icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" role="img" aria-hidden="true" focusable="false">
                <path d="M13.5 6C10.5 6 8 8.5 8 11.5c0 1.1.3 2.1.9 3l-3.4 3 1 1.1 3.4-2.9c1 .9 2.2 1.4 3.6 1.4 3 0 5.5-2.5 5.5-5.5C19 8.5 16.5 6 13.5 6zm0 9.5c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4z">
                </path>
              </svg>
            </div>
        </div>
      </div>
    </div>
  </div>
  `});PPVue.component("pp-radio-button",{data(){return{}},props:{id:String,disabled:Boolean,submit:Boolean,selected:Boolean},methods:{onClick(e){if(this.disabled){return}if(this.submit){return true}this.$emit("click",e)},onFocus(e){this.$emit("focus",e)},onBlur(e){this.$emit("blur",e)}},computed:{isDisabled(){return this.disabled},classes(){return{"components-button":true,"is-secondary":!this.selected,"is-primary":this.selected}}},template:`<button
  type="button"
  :id="id"
  :class="classes"
  role="radio"
  :disabled="isDisabled"
  @click="onClick"><slot></slot></button>`});PPVue.component("pp-radio-group",{data(){return{}},props:{},methods:{},template:`<div role="radiogroup" class="components-button-group" aria-label="options"><slot></slot></div>`});PPVue.component("pp-select",VueSelect.VueSelect);PPVue.component("pp-codemirror",{props:{value:{type:String,default:""},options:{type:Object,default(){return{mode:"text/javascript",lineNumbers:true,lineWrapping:true}}}},data(){return{skipNextChangeEvent:false}},ready(){this.editor=wp.CodeMirror.fromTextArea(this.$el.querySelector("textarea"),this.options);this.editor.setValue(this.value);this.editor.on("change",e=>{if(this.skipNextChangeEvent){this.skipNextChangeEvent=false;return}this.value=e.getValue();if(!!this.$emit){this.$emit("change",e.getValue())}})},mounted(){this.editor=wp.CodeMirror.fromTextArea(this.$el.querySelector("textarea"),this.options);this.editor.setValue(this.value);this.editor.on("change",e=>{if(this.skipNextChangeEvent){this.skipNextChangeEvent=false;return}if(!!this.$emit){this.$emit("change",e.getValue());this.$emit("input",e.getValue())}})},watch:{value(e,t){const i=this.editor.getValue();if(e!==i){this.skipNextChangeEvent=true;const s=this.editor.getScrollInfo();this.editor.setValue(e);this.editor.scrollTo(s.left,s.top)}},options(e,t){if(typeof e==="object"){for(const i in e){if(e.hasOwnProperty(i)){this.editor.setOption(i,e[i])}}}}},beforeDestroy(){if(this.editor){this.editor.toTextArea()}},template:`<div class="vue-codemirror-wrap"><textarea></textarea></div>`});PPVue.component("pp-notice",{props:{status:{type:String,default:"info",validator:function(e){return["info","success","warning","error"].indexOf(e)!==-1}}},computed:{getStatus(){return`notice-${this.status}`}},template:`<div class="notice" :class="getStatus" style="position:relative;margin-left: 0;margin-right: 0;">
<slot></slot>
<a class="notice-dismiss" style="text-decoration: none" @click="$emit('close')"></a>
</div>`});PPVue.component("vue-slider",window["vue-slider-component"]);PPVue.component("pp-post-layer",{props:{isShow:{type:Boolean,default:false},template:{type:Number,default:"info"},userName:{type:String,default:""}},data(){return{isLoadIntercom:false}},created(){const e=new MutationObserver(e=>{e.forEach(({addedNodes:e,previousSibling:t})=>{e.forEach(e=>{if("intercom-lightweight-app"===e.className&&"intercom-frame"===t?.id){this.isLoadIntercom=true}else if(e.children?.["intercom-borderless-frame"]){this.closeHandle()}})})});e.observe(document.body,{childList:true,subtree:true})},mounted(){window.PPLiveChat("onShow",()=>{this.$emit("show",false)});if(jQuery(".pp-intercom-loader-placeholder").length){this.isLoadIntercom=true}},methods:{closeHandle(){this.$emit("show",false)},newMsgHandle(){this.showNewMessage()},showNewMessage(){this.closeHandle();window.PPLiveChat("showNewMessage","")}},template:`<transition name="slide-fade">
<div class="pp-post-layer" v-show="isLoadIntercom && isShow" @click.stop="newMsgHandle">
<header class="pp-post-layer-header"><div class="logo"><img src="https://static.intercomassets.com/avatars/3673103/square_128/Screenshot_2021-10-29_104652-1635475918.png?1635475918" alt="Lexie profile"></div><div class="title"><div><span class="pp-post-layer-nickname">Lexie </span>from Parcel Panel</div><div><span class="badge"></span>Active</div></div><span class="close" @click.stop="closeHandle"></span></header>

<!-- 打招呼 -->
<template v-if="template === 2">
  <post-layer-template-greet-post/>
</template>

<!-- 订单页面需要帮助显示的 -->
<template v-if="template === 3">
  <post-layer-template-order-message-post/>
</template>

<div class="pp-post-layer-footer" @click="showNewMessage">
  <div class="pp-post-layer-input">
    <input type="text" placeholder="Live chat with us">

    <div class="pp-post-layer-button-group">
      <button class="pp-post-layer-button-item svg-btn">
        <svg focusable="false" aria-hidden="true" viewBox="0 0 29 18"><g fill-rule="evenodd"><path d="M9 1a8 8 0 1 0 0 16h11a8 8 0 1 0 0-16H9zm0-1h11a9 9 0 0 1 0 18H9A9 9 0 0 1 9 0z" fill-rule="nonzero"></path><path d="M6.561 9.337c0-2.277 1.683-3.795 3.773-3.795 1.298 0 2.2.572 2.849 1.375l-.726.451c-.462-.594-1.243-1.012-2.123-1.012-1.606 0-2.827 1.232-2.827 2.981 0 1.738 1.221 2.992 2.827 2.992.88 0 1.606-.429 1.969-.792v-1.496H9.784v-.814h3.432v2.651a3.822 3.822 0 0 1-2.882 1.265c-2.09 0-3.773-1.529-3.773-3.806zM14.701 13V5.663h.913V13h-.913zm2.629 0V5.663h4.807v.814h-3.894v2.365h3.817v.814h-3.817V13h-.913z"></path></g></svg>
      </button><button class="pp-post-layer-button-item svg-btn">
        <svg focusable="false" aria-hidden="true" viewBox="0 0 18 18"><path d="M9 0a9 9 0 1 1 0 18A9 9 0 0 1 9 0zm0 1C4.589 1 1 4.589 1 9s3.589 8 8 8 8-3.589 8-8-3.589-8-8-8zM5 6.999a1 1 0 1 1 2.002.004A1 1 0 0 1 5 6.999zm5.999 0a1.002 1.002 0 0 1 2.001 0 1 1 0 1 1-2.001 0zM8.959 13.5c-.086 0-.173-.002-.26-.007-2.44-.132-4.024-2.099-4.09-2.182l-.31-.392.781-.62.312.39c.014.017 1.382 1.703 3.37 1.806 1.306.072 2.61-.554 3.882-1.846l.351-.356.712.702-.35.356c-1.407 1.427-2.886 2.15-4.398 2.15z" fill-rule="evenodd"></path></svg>
      </button><button class="pp-post-layer-button-item svg-btn">
        <svg focusable="false" aria-hidden="true" viewBox="0 0 16 18"><path d="M14.154 6.918l-.004.003.001-.004-3.287 3.286-.006-.005-3.574 3.574c-.016.017-.03.036-.048.053l-.05.047-.043.041v-.002c-1.167 1.07-2.692 1.331-3.823.2-1.13-1.13-.89-2.677.18-3.843l-.005-.004.074-.073.016-.018c.006-.005.012-.009.017-.016l6.053-6.053.761.76-6.053 6.054-.029.028v.001l-.005.004-.073.074c.011-.01.025-.018.035-.03-.688.75-.93 1.636-.21 2.356.72.72 1.583.456 2.333-.232l-.03.034.04-.042.01-.008.008-.009.033-.03.031-.034.01-.009.007-.009 5.004-5.003.005.006 1.858-1.859c1.223-1.218 1.51-2.913.291-4.132C12.462.806 10.414.74 9.195 1.958L2.248 8.905c.003 0 .006-.002.008-.004-1.625 1.667-1.542 4.43.103 6.074 1.646 1.646 4.474 1.795 6.141.17-.003.002-.004.008-.008.012l.047-.047 6.053-6.054.042-.042.743.78-.025.021.001.002-6.05 6.05-.002.002-.002.001-.046.046h-.002c-2.094 2.04-5.578 1.894-7.652-.18-2.049-2.049-2.15-5.407-.183-7.505l-.006-.005h-.002l.076-.078 6.943-6.944.003-.002.004-.005c1.641-1.64 4.367-1.574 6.008.066 1.64 1.642 1.353 4.014-.288 5.655z" fill-rule="evenodd"></path></svg>
      </button>
    </div>
  </div>
</div>
</div>
</transition>`});PPVue.component("post-layer-template-greet-post",{template:`<div>
<div class="pp-post-layer-title">Welcome to ParcelPanel 🎉</div>
<div class="pp-post-layer-body">
  <p>Hello 😀 ,</p>
  <p>We’re so glad you’re here, let us know if you have any questions.</p>
</div>
</div>`});PPVue.component("post-layer-template-order-message-post",{template:`<div class="pp-post-layer-body">
<p>Any questions about orders sync, courier matching or tracking update?</p>
</div>`});PPVue.component("pp-edt-time-slider",{props:{value:{type:Array,default:[10,20]},min:{type:Number,default:1},max:{type:Number,default:90}},methods:{change(e){this.$emit("input",e)}},template:`<div>
<div>Estimated delivery time: {{value[0]}} - {{value[1]}}(d)</div>
<vue-slider :value="value" @change="change" tooltip="hover" :min="min" :max="max" dot-size="20" class="pp-m-t-2"></vue-slider>
</div>`});PPVue.component("pp-new-badge",{props:{endTime:Number},data(){const e=(new Date).getTime()<this.endTime;return{isShow:e}},template:`<span v-if="isShow" class="parcelpanel-new-badge"></span>`});PPVue.component("pp-popup-pic",{template:`<div v-if="isShow" class="pp-popup-pic"><div v-show="!isOpened" class="pp-popup-pic-pendant" @click="handlePendantClick"></div><div v-if="isOpened" class="pp-popup-pic-modal-container"><div class="pp-popup-pic-modal"><div class="pp-popup-pic-modal-body" @click="handleModalClick"><div><img src="https://cdn.parcelpanel.com/wc/assets/popup/imgs/heading2.png" alt width="100%" height="auto"></div><div class="pp-popup-pic-p2">Offer Will Expire Soon <span class="pp-countdown">{{ countdown }}</span></div><div><img src="https://cdn.parcelpanel.com/wc/assets/popup/imgs/section2.png" alt width="100%" height="auto"></div></div><button @click="handleCloseButtonClick" class="modal-close-button"><svg viewBox="0 0 20 20" focusable="false" aria-hidden="true"><path d="m11.414 10 6.293-6.293a1 1 0 1 0-1.414-1.414l-6.293 6.293-6.293-6.293a1 1 0 0 0-1.414 1.414l6.293 6.293-6.293 6.293a1 1 0 1 0 1.414 1.414l6.293-6.293 6.293 6.293a.998.998 0 0 0 1.707-.707.999.999 0 0 0-.293-.707l-6.293-6.293z"></path></svg></button></div></div></div>`,data(){return{isShow:false,version:"1.0",openedAt:0,timeDiff:0,timer:void 0,remainTime:0,isOpened:false}},created(){this.openedAt=window.parcelpanel_param.popup.opened_at;this.timeDiff=(new Date).getTime()/1e3-window.parcelpanel_param.popup.server_time;this.isShow=window.parcelpanel_param.popup.is_show},mounted(){if(!this.isShow){return}if(window.parcelpanel_param.popup.last_popup_date!==this.getNowDate()){window.parcelpanel_param.popup.last_popup_date=this.getNowDate();this.modalAutoOpen()}},methods:{updateCountdown(){const e=2592e3;this.remainTime=Math.ceil(e-((new Date).getTime()/1e3-this.timeDiff-this.openedAt)%e-1)},modalAutoOpen(){this.reqPopupAction("open:1");this.modalOpen()},handlePendantClick(){this.reqPopupAction("open:2");this.modalOpen()},handleModalClick(e){this.reqPopupAction("close:3");this.intercomNewMessage();this.modalClose()},handleCloseButtonClick(){this.reqPopupAction("close:4");this.modalClose()},modalOpen(){if(!this.timer){this.updateCountdown();this.timer=setInterval(()=>{this.updateCountdown()},100)}this.isOpened=true},modalClose(){this.isOpened=false;if(this.timer){clearInterval(this.timer);this.timer=void 0}},intercomNewMessage(){window.PPLiveChat("showNewMessage","Hi support, I would like to free upgrade to the Unlimited plan.")},reqPopupAction(e){const t={action:e,date:this.getNowDate(),v:this.version,t:(new Date).toString(),url:location.href,referrer:document.referrer,w:document.body.clientWidth,h:document.body.clientHeight};fetch(`${ajaxurl}?action=pp_popup_action&_ajax_nonce=${window.parcelpanel_param.popup.nonce}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})},formatTimeDisplay(e){return`${e<10?`0${e}`:e}`},getNowDate(){const e=new Date;return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}},computed:{countdown(){const e=Math.floor(this.remainTime/86400);const t=Math.floor(this.remainTime/3600%24);const i=Math.floor(this.remainTime/60%60);const s=Math.floor(this.remainTime%60);return`${e>0?`${e}${e===1?"day":"days"} `:""}${this.formatTimeDisplay(t)}:${this.formatTimeDisplay(i)}:${this.formatTimeDisplay(s)}`}}});